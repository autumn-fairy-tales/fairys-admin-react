# 状态实例

:::tip 内置状态实例

在设置初始状态时，需要在渲染`Layout`和`FairysRoot`组件之前调用

:::


## accountDataInstance 账号信息

:::tip

用于存储当前登录用户的账号信息，包括用户名、用户头像、用户邮箱、用户手机号、用户角色等。

:::



**引入**

```ts
import { accountDataInstance } from '@fairys/admin-tools-react';
```

**状态值**

```ts
interface AccountDataState {
  /**用户名*/
  userName?: string;
  /**用户头像*/
  userAvatar?: string;
  /**用户邮箱*/
  userEmail?: string;
  /**用户手机号*/
  userPhone?: string;
  /**用户角色*/
  userRole?: string;
  /**其他自定义信息*/
  info?: Record<string, any>;
  /**默认引用值*/
  __defaultValue?: string;
}
```

**实体类**

```ts
export class AccountDataInstance {
    state: AccountDataState;
    /**更新数据信息*/
    updated: (state: AccountDataState) => void;
    /**清空账户数据*/
    clear: () => void;
}
```

**hooks**

```ts
export  const useAccountData: () => [AccountDataState, AccountDataInstance, AccountDataState["__defaultValue"]];
```

## aliveControllerBaseInstance 页面缓存

:::tip

用于缓存当前页面的组件实例。

:::


**引入**

```ts
import { aliveControllerBaseInstance } from '@fairys/admin-tools-react';
```

**实体类**

```ts
import type { AliveController } from 'react-activation';
export class AliveControllerBase {
    aliveController: AliveController;
    /**转换路由值列表*/
    static convertIdOrNameList: (value: string[]) => string[];
    /**清空缓存*/
    clear: () => void;
    /**删除缓存*/
    drop: (name: string) => void;
    /**删除缓存ById*/
    dropById: (id: string) => void;
    /**删除缓存Scope*/
    dropScope: (name: string) => void;
    /**删除缓存ScopeByIds*/
    dropScopeByIds: (ids: string[]) => void;
    /**刷新缓存*/
    refresh: (name: string) => void;
    /**刷新缓存ById*/
    refreshById: (id: string) => void;
    /**刷新缓存Scope*/
    refreshScope: (name: string) => void;
    /**刷新缓存ScopeByIds*/ 
    refreshScopeByIds: (ids: string[]) => void;
    /**获取缓存节点*/
    getCachingNodes: () => import("react-activation").CachingNode[];
}
```

## appDataInstance 应用数据

:::tip

用于存储当前应用的全局数据，包括路由信息、设置信息、菜单信息、标签栏信息、账号信息、运动动画信息、应用插件信息、通知信息、收藏信息等。

:::


**引入**

```ts
import { appDataInstance } from '@fairys/admin-tools-react';
```

**实体类**

```ts
import { AliveControllerBase } from './alive-controller';
import { AuthDataInstance } from './auth-data';
import { FavoritesDataInstance } from './favorites-data';
declare class AppDataInstance {
    static router: import("./router-data").RouterDataInstance;
    static setting: import("./setting").SettingInstance;
    static menu: import("./menu-data").MenuDataInstance;
    static tabBar: import("./tab-bar").TabBarInstance;
    static account: import("./account-data").AccountDataInstance;
    static motionAnimation: import("./motion-animation").MotionAnimationInstance;
    static appPlugin: import("./app-plugins-data").AppPluginDataInstance;
    static notification: import("./notification-data").NotificationDataInstance;
    static favoritesDataInstance: FavoritesDataInstance;
    /**挂载的AliveController*/
    aliveController: AliveControllerBase;
    authDataInstance: AuthDataInstance;
    /**清空tab项*/
    clear: () => void;
}
```

## appPluginDataInstance 应用插件数据

:::tip

用于存储当前应用的插件数据，包括工具条右侧插件、头像菜单插件等。

:::


**引入**

```ts
import { appPluginDataInstance } from '@fairys/admin-tools-react';
```

**实体类**

```ts
import { FairysPopoverMenuItemType } from '../components/popover-menu';
export type AppPluginType = {
    /**工具条右侧插件*/
    'toolBar-right'?: {
        /**渲染组件*/
        render?: React.ReactNode;
        /**渲染重写函数*/
        override?: (menus: React.ReactNode[]) => React.ReactNode;
    };
    /**头像菜单插件*/
    'avatar-menus'?: {
        /**添加菜单项*/
        menus?: FairysPopoverMenuItemType[];
        /**重写菜单项*/
        override?: (menus: FairysPopoverMenuItemType[]) => FairysPopoverMenuItemType[];
    };
};

export class AppPluginDataInstance {
    /**插件组件*/
    appPlugins: AppPluginType;
    /**添加插件*/
    addPlugin: (plugin: AppPluginType) => void;
    /**清空数据*/
    clear: () => void;
}
```

## authDataInstance 认证数据

:::tip

用于存储当前应用的认证数据，包括登录状态、菜单权限、按钮权限、忽略权限等。

:::

**引入**

```ts
import { authDataInstance } from '@fairys/admin-tools-react';
```

**状态值**

```ts
export interface AuthDataState {
    /**
     * NoAuth 没权限
     * Auth 有权限，已进入页面
     * RequestAuth 加载中权限中
     * Login 进入登录页面
     */
    status: 'NoAuth' | 'Auth' | 'RequestAuth' | 'Login';
    /**菜单权限*/
    menusPermissions: string[];
    /**按钮权限*/
    btnsPermissions: string[];
    /**忽略权限(忽略权限不会进行权限判断，不分按钮还是菜单,在判断时始终为true)*/
    ignorePermissions: string[];
    /**默认引用值*/
    __defaultValue?: string;
}
```

**实体类**

```ts
export declare class AuthDataInstance {
    constructor();
    state: AuthDataState;
    updatedStatus: (status: AuthDataState["status"]) => void;
    /**退出登录(需要外部赋值)*/
    onLogout: () => void;
    /**内部退出登录*/
    _onLogout: () => void;
    /**设置忽略权限*/
    setIgnorePermissions: (permissions: string[]) => void;
    /**设置菜单权限*/
    setMenusPermissions: (permissions: string[]) => void;
    /**是否有菜单权限*/
    isMenuAuth: (path: string) => boolean;
    /**设置按钮权限*/
    setBtnsPermissions: (permissions: string[]) => void;
    /**是否有按钮权限*/
    isBtnAuth: (path: string) => boolean;
    /**清空数据*/
    clear: () => void;
}

```

**hooks**

```ts
export  const useAuthDataInstance: () => [AuthDataState, AuthDataInstance, AuthDataState["__defaultValue"]];
```

## favoritesDataInstance 收藏数据

:::tip

用于存储当前应用的收藏数据，包括收藏的菜单项。

:::

**引入**

```ts
import { favoritesDataInstance } from '@fairys/admin-tools-react';
```

**状态值**

```ts
import { MenuItemType } from './menu-data';
export type FavoritesDataState = {
    /**列表数据*/
    dataList?: MenuItemType[];
    /**默认引用值*/
    __defaultValue?: string;
};
```

**实体类**

```ts
import { MenuItemType } from './menu-data';
export declare class FavoritesDataInstance {
    static localStorageKey: string;
    state: FavoritesDataState;
    constructor();
    /**添加*/
    addItem: (item: MenuItemType) => void;
    /**移除*/
    removeItem: (item: MenuItemType) => void;
    /**清空数据*/
    clear: () => void;
}
```

**hooks**

```ts
export  const useFavoritesData: () => [FavoritesDataState, FavoritesDataInstance, FavoritesDataState["__defaultValue"]];
```

## menuDataInstance 菜单数据

:::tip

用于存储当前应用的菜单数据，包括侧边渲染菜单、主菜单、主菜单选中项、展开项、主菜单展开项等。

:::

**引入**

```ts
import { menuDataInstance } from '@fairys/admin-tools-react';
```

**状态值**

```ts
export interface MenuDataInstanceState {
  /**侧边渲染菜单*/
  menuItems: MenuItemType[];
  /**主菜单*/
  mainMenuItems: MenuItemType[];
  /**主菜单选中项*/
  mainMenuItemSelected?: string;
  /**展开项*/
  expandItems: MenuItemType[];
  /**主菜单展开项*/
  mainExpandItem?: MenuItemType;
  /**搜索菜单*/
  searchMenuItems?: MenuItemType[];
  /**默认引用值*/
  __defaultValue?: string;
}

export interface MenuItemType {
  /**标题*/
  title: string;
  /**路径*/
  path: string;
  /**图标*/
  icon?: string;
  /**图标属性*/
  iconProps?: IconProps;
  /**判断是否主子菜单字段，仅在第一层生效*/
  isMain?: boolean;
  /**在left布局中，父级是否显示
   * @default true
   */
  left_isMainShow?: boolean;
  /**子项菜单*/
  items?: MenuItemType[];
  /**是否为固定菜单,(直接固定到tabbar上，不可删除)*/
  isTabFixed?: boolean;
  /**排序-固定菜单*/
  sortTabFixed?: number;
  /**样式属性*/
  className?: string;
  /**是否打开浏览器新窗口*/
  isOpenNewWindow?: boolean;
  /**跳转之前触发，返回 false 则不跳转*/
  onBeforeNavigate?: (item: MenuItemType) => boolean | Promise<boolean>;
  [x: string]: any;
}

```

**实体类**

```ts
export class MenuDataInstance {
    /**原始整个菜单*/
    _menuItems: MenuItemType[];
    /**平铺所有菜单数据*/
    _flatMenuItems: MenuItemType[];
    /**地址查找父级路径*/
    _parentMenuItemMap: Map<string, MenuItemType[]>;
    /**菜单数据状态*/
    state: MenuDataInstanceState;
    /**设置菜单所有数据*/
    ctor: (items: MenuItemType[]) => void;
    /**更新主菜单展开项*/
    updateMainExpandItem: (item?: MenuItemType) => void;
    /**
     * 通过path获取菜单对象
     * 暂不支持 /path/:id 这种动态路由
     */
    get_path_menuItem: (path: string) => MenuItemType;
    /**搜索菜单*/
    onSearch: (word: string) => void;
    /**判断是否是父级菜单*/
    isParentMenuItem: (path: string, location_path: string) => boolean;
    /**清空展开项*/
    clearExpandItems: () => void;
    /**展开项*/
    onExpandItems: (path: string) => void;
    /**折叠*/
    onCollapseItems: (path: string) => void;
    /**切换展示隐藏*/
    onToggleItems: (path: string) => void;
    /**是否展示*/
    isExpand: (path: string) => boolean;
    /**更新子菜单显示,和主菜单选中项*/
    updateChildMenus: (path: string) => void;
    /**点击主菜单切换*/
    onMainMenu: (path: string) => void;
    /**清空*/
    clear: () => void;
    /**跳转之前触发，返回 false 则不跳转*/
    onBeforeNavigate?: (item: MenuItemType) => boolean | Promise<boolean>;
}
```

**hooks**

```ts
export const useMenuData: () => [MenuDataInstanceState, MenuDataInstance, string | undefined];
```

## motionAnimationInstance 页面动画

:::tip

用于存储当前应用的页面动画配置，包括页面切换动画、弹窗动画等。

:::

**引入**

```ts
import { motionAnimationInstance } from '@fairys/admin-tools-react';
```

**配置**

```ts
import type { MotionNodeAnimationOptions } from 'framer-motion';
interface MotionAnimationState {
    name: string;
    config: MotionNodeAnimationOptions & {
        style?: React.CSSProperties;
        className?: string;
    };
}

```

**实体类**

```ts
import type { MotionNodeAnimationOptions } from 'framer-motion';
/**页面动画配置*/
export declare class MotionAnimationInstance {
    state: MotionAnimationState[];
    /**扩展动画*/
    expands: (list: MotionAnimationState[]) => void;
    /**获取配置*/
    getAnimationConfig: (name: string) => MotionNodeAnimationOptions & {
        style?: React.CSSProperties;
        className?: string;
    };
}
```

## notificationDataInstance 通知数据

:::tip

用于存储当前应用的通知数据，包括通知tab列表、通知列表数据、通知标题等。

:::

**引入**

```ts
import { notificationDataInstance } from '@fairys/admin-tools-react';
```

**状态值**

```ts
import { IconProps } from '@iconify/react';
export type NotificationDataState = {
    /**通知tab列表*/
    tabItems?: NotificationTabItemType[];
    activeKey?: string;
    /**列表数据(在不分类的时候渲染)*/
    dataList?: Pick<NotificationItemType, 'type'>[];
    /**通知标题*/
    title?: string;
    /**是否显示图标
     * @default true
     */
    isShowIcon?: boolean;
    /**默认引用值*/
    __defaultValue?: string;
    /**显示数量*/
    count?: number;
    /**是否显示更多弹窗*/
    visibleMoreModal?: boolean;
};

export interface NotificationTabItemType {
    /**tab标题*/
    title: string;
    /**tab键*/
    key: string;
    /**图标*/
    icon?: string;
    /**图标属性*/
    iconProps?: IconProps;
    [s: string]: any;
}
export interface NotificationItemType {
    /**通知id*/
    id: string;
    /**通知类型*/
    type: string;
    /**通知标题*/
    title: string;
    /**通知时间*/
    date: string;
    /**通知内容*/
    content?: string;
    /**图标*/
    icon?: string;
    /**图标属性*/
    iconProps?: IconProps;
    [s: string]: any;
}
```

**实体类**

```ts
export class NotificationDataInstance {
    state: NotificationDataState;
    ctor: (options: {
        tabItems?: NotificationTabItemType[];
        title?: string;
        isShowIcon?: boolean;
    }) => void;
    /**更新值 tabs 选项key（外部挂载事件）*/
    onUpdateActiveKey?: (key: string) => void;
    /**更新值*/
    _onUpdateActiveKey: (key: string) => void;
    /**根据类型获取数据*/
    getDataType: (type: string) => any;
    /**根据类型更新数据*/
    updatedToType: (type: string, data: NotificationItemType[]) => void;
    /**获取数据*/
    getDataList: () => Pick<NotificationItemType, "type">[];
    /**更新列表数据*/
    updateDataList: (data: NotificationItemType[]) => void;
    /**点击数据(外部挂载事件)*/
    onClickItem?: (item: NotificationItemType) => void;
    /**点击数据*/
    _onClickItem: (item: NotificationItemType) => void;
    /**点击查看全部(外部挂载事件)*/
    onClickMore?: (activeKey: string) => void;
    /**关闭更多弹窗*/
    closeMoreModal: () => void;
    /**点击查看全部*/
    _onClickMore: () => void;
    /**清空数据*/
    clear: () => void;
}
```

**hooks**

```ts
export const useNotificationData: () => [NotificationDataState, NotificationDataInstance, NotificationDataState["__defaultValue"]];
```

## routerDataInstance 路由数据

:::tip

用于存储当前应用的路由数据，包括路由配置、路由跳转方法等。

:::

**引入**

```ts
import { routerDataInstance } from '@fairys/admin-tools-react';
```

**实体类**

```ts
import type { DataRouter, NavigateFunction, To, NavigateOptions, RouteObject, DOMRouterOpts, MemoryRouterOpts } from 'react-router';
export class RouterDataInstance {
    router: DataRouter | undefined;
    /**从root挂载的数据*/
    __navigate: NavigateFunction;
    /**跳转前回调*/
    onNavigateBefore: (to: To, next: (to?: To, options?: NavigateOptions) => void) => Promise<boolean>;
    /**内置跳转方法*/
    navigate: (to: To | number, options?: NavigateOptions) => Promise<void>;
    createBrowserRouter: (routes: RouteObject[], opts?: DOMRouterOpts) => DataRouter;
    createMemoryRouter: (routes: RouteObject[], opts?: MemoryRouterOpts) => DataRouter;
    createHashRouter: (routes: RouteObject[], opts?: DOMRouterOpts) => DataRouter;
    /**清空tab项*/
    clear: () => void;
}
```

## settingInstance 设置数据

:::tip

用于存储当前应用的设置数据，包括导航栏模式、侧边栏模式、页面切换动画、标签栏等。

:::

**引入**

```ts
import { settingInstance } from '@fairys/admin-tools-react';
```

**状态值**

```ts
/**
 * 1. main_sub_left:左侧主菜单 + 子菜单 + 无头部信息
 * 2. main_left:左侧主菜单 + 移入子菜单展示 + 无头部信息
 * // 3. main_left_sub_all:左侧主菜单 + 移入子菜单展示所有  + 无头部信息
 * 4. main_top_header:顶部菜单 +  移入子菜单展示 + 有头部信息
 * // 5. main_top_sub_all_header:顶部菜单 +  移入子菜单展示所有 + 有头部信息
 * 6. main_top_sub_left_header:顶部主菜单 + 侧边子菜单 + 有头部信息
 * 7. left:不区分主子菜单并且左侧显示 + 无头部信息(用户信息一起移入左侧显示)
 * 8. left_header:不区分主子菜单并且左侧显示 + 有头部信息
 * 9. mobile:移动端布局,不进行区分主子菜单，使用弹框展示，布局使用 `left` 布局
 */
export type LayoutMode = 'main_sub_left' | 'main_left' | 'main_top_header' | 'main_top_sub_left_header' | 'left' | 'left_header' | 'mobile';
export interface SettingInstanceState {
    /**是否打开偏好设置*/
    open?: boolean;
    /**logo加载地址*/
    logo?: string;
    /**项目名*/
    projectName?: string;
    /**颜色主题风格*/
    theme?: 'dark' | 'light';
    /**自动监听系统的明暗色系*/
    autoListenSystemTheme?: boolean;
    /**主题颜色*/
    themeColor?: string;
    /**导航栏模式*/
    layoutMode?: LayoutMode;
    /**旧的导航栏模式,(用于切换mobile布局时，切换回旧的布局模式)*/
    _oldLayoutMode?: LayoutMode;
    /**暗黑导航栏*/
    darkMenu?: boolean;
    /**侧边栏模式*/
    sideMenuMode?: 'open' | 'close';
    /**页面切换动画*/
    pageTransitionMode?: '无动画' | '滑动' | '缩放消退' | '闪现' | '淡入淡出' | string;
    /**标签栏*/
    /**是否启用标签栏*/
    enableTabBar?: boolean;
    /**是否显示图标*/
    tabBarShowIcon?: boolean;
    /**标签页双击执行动作*/
    tabBarDoubleClickAction?: '';
    /**工具栏*/
    /**是否启用工具栏*/
    enableToolBar?: boolean;
    /**是否启用收藏夹*/
    enableToolBarFavorites?: boolean;
    /**收藏夹最多可存储多少个*/
    favoritesMaxLength?: number;
    /**面包屑导航*/
    enableToolBarBreadcrumb?: boolean;
    /**导航搜索*/
    enableToolBarSearch?: boolean;
    /**通知中心*/
    enableToolBarNotification?: boolean;
    /**全屏*/
    enableToolBarFullScreen?: boolean;
    isFullScreen?: boolean;
    /**页面刷新*/
    enableToolBarRefresh?: boolean;
    /**是否启用页面水印*/
    enableWatermark?: boolean;
    /**
     * 判断屏幕宽度是否是移动端布局
     * @default 1024
     */
    maxWidthScreen?: number;
    isMobile?: boolean;
    /**只是默认值，不使用*/
    __defaultValue?: string;
}
```

**实体类**

```ts

export declare class SettingInstance {
    static localStorageKey: string;
    state: SettingInstanceState;
    constructor();
    /**初始配置*/
    initSetting: (state: SettingInstanceState) => void;
    /**监听系统主题变化*/
    mediaQueryList: MediaQueryList | null;
    /**更新文档和body的主题*/
    setDocumentAndBodyTheme: () => void;
    /**监听事件更新系统主题*/
    onListenChangeSystemTheme: (e: MediaQueryListEvent) => void;
    /**自动监听系统的明暗色系*/
    autoListenSystemTheme: () => void;
    /**切换自动监听系统的明暗色系*/
    onToggleAutoListenSystemTheme: (autoListenSystemTheme: boolean) => void;
    /**点击设置切换主题*/
    onToggleTheme: (theme: "light" | "dark" | "system") => void;
    /**更新主题颜色*/
    updatedThemeColor: (themeColor: string) => void;
    /**更新配置*/
    updated: (state: SettingInstanceState) => void;
    /**判断是否主子菜单模板*/
    isMainSubMenuMode: () => boolean;
    /**切换打开偏好设置*/
    onToggleOpen: () => void;
    /**全屏监听*/
    onFullscreenChange: () => void;
    addEventListenerFullscreenChange: () => () => void;
    /**全屏*/
    onToggleFullScreen: () => Promise<void>;
    /**监听屏幕变化，用于控制菜单布局*/
    mediaQueryListScreen: MediaQueryList | null;
    /**监听屏幕变化，用于控制菜单布局*/
    onListenChangeScreen: (e: MediaQueryListEvent) => void;
    /**自动监听屏幕变化，用于控制菜单布局*/
    autoListenScreen: () => () => void;
    /**清空*/
    clear: () => void;
}
```

**hooks**

```ts
export const useSetting: () => [SettingInstanceState, SettingInstance, string | undefined];
```

## tabBarInstance 页面标签栏

:::tip

用于存储当前应用的页面标签栏数据，包括标签栏项集合、右侧选择的标签栏项集合、页面是否全屏等。

:::

**引入**

```ts
import { tabBarInstance } from '@fairys/admin-tools-react';
```

**状态值**

```ts
import type { MenuItemType } from './menu-data';
export interface TabBarItemType extends MenuItemType {
}
export interface TabBarInstanceState {
    /**tab项集合*/
    tabBarItems: TabBarItemType[];
    /**右侧选择的tab项集合,不在可视区域的数据*/
    dropDownTabBarItems: TabBarItemType[];
    /**页面是否全屏*/
    pageFullScreen?: boolean;
    /**默认引用值*/
    __defaultValue?: string;
}
```

**实体类**

```ts
export class TabBarInstance {
    state: TabBarInstanceState;
    /**初始化渲染菜单数据*/
    ctor: (tabBarItems: MenuItemType[]) => void;
    /**添加tab项*/
    addItem: (item: TabBarItemType) => void;
    /**根据path添加tab项*/
    add: (path: string) => void;
    /**删除tab项*/
    remove: (path: string, isActive: boolean) => void;
    /**设置页面是否全屏*/
    onToggleFullScreen: () => void;
    /**关闭其他标签*/
    removeOther: (current: number, isActive: boolean) => void;
    /**移除左侧*/
    removeLeft: (current: number, isActive: boolean) => void;
    /**移除右侧*/
    removeRight: (current: number, isActive: boolean) => void;
    /**清空tab项*/
    clear: () => void;
}
```

**hooks**

```ts
export const useTabBar: () => [TabBarInstanceState, TabBarInstance, string | undefined];
```
